<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Escape Room Matem√°tico Avan√ßado - 5¬∫ Ano</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Comic Sans MS', cursive, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #333;
      min-height: 100vh;
      padding: 10px;
    }
    
    @media (min-width: 768px) {
      body {
        overflow: hidden;
        height: 100vh;
      }
    }
    
    .container {
      max-width: 400px;
      margin: 0 auto;
      background: white;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      overflow: hidden;
      max-height: calc(100vh - 20px);
    }
    
    .header {
      background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
      color: white;
      padding: 15px;
      text-align: center;
    }
    
    .stats {
      display: flex;
      justify-content: space-between;
      background: #f8f9fa;
      padding: 10px 15px;
      font-size: 14px;
      font-weight: bold;
    }
    
    .penalty-cards {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin: 10px 0;
      background: #f8f9fa;
      padding: 10px;
      border-top: 1px solid #dee2e6;
    }
    
    .card {
      border: none;
      background: none;
      font-size: 2.2em;
      cursor: pointer;
      transition: transform 0.2s;
      padding: 5px;
      border-radius: 5px;
    }
    
    .card:active {
      transform: scale(1.2);
    }
    
    .card.yellow { 
      color: #f7d51d;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
    }
    
    .card.red { 
      color: #e74c3c;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
    }
    
    .card:hover {
      background: rgba(0,0,0,0.1);
    }
    
    .room {
      display: none;
      padding: 20px;
      min-height: 400px;
      max-height: calc(100vh - 250px);
      overflow-y: auto;
    }
    
    .room.active {
      display: block;
    }
    
    .team-setup {
      text-align: center;
    }
    
    .team-setup input {
      width: 100%;
      padding: 15px;
      margin: 15px 0;
      border: 2px solid #ddd;
      border-radius: 10px;
      font-size: 16px;
      text-align: center;
    }
    
    .question {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 10px;
      margin: 15px 0;
      border-left: 4px solid #4ecdc4;
    }
    
    .answer-input {
      width: 100%;
      padding: 15px;
      margin: 10px 0;
      border: 2px solid #ddd;
      border-radius: 10px;
      font-size: 18px;
      text-align: center;
    }
    
    .btn {
      width: 100%;
      padding: 15px;
      background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      margin: 10px 0;
      transition: transform 0.2s;
    }
    
    .btn:hover {
      transform: scale(1.05);
    }
    
    .btn:disabled {
      background: #ccc;
      transform: none;
    }
    
    .feedback {
      margin: 15px 0;
      padding: 10px;
      border-radius: 8px;
      text-align: center;
      font-weight: bold;
    }
    
    .success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    
    .error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    
    .warning {
      background: #fff3cd;
      color: #856404;
      border: 1px solid #ffeaa7;
    }
    
    .penalty-message {
      background: #fff3cd;
      color: #856404;
      border: 1px solid #ffeaa7;
      margin: 10px 0;
      padding: 15px;
      border-radius: 8px;
      text-align: center;
      font-weight: bold;
      animation: shake 0.5s;
    }
    
    .retrograde-message {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
      margin: 10px 0;
      padding: 15px;
      border-radius: 8px;
      text-align: center;
      font-weight: bold;
      animation: shake 0.8s;
    }
    
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }
    
    .hint {
      background: #fff3cd;
      color: #856404;
      border: 1px solid #ffeaa7;
      margin: 10px 0;
      padding: 10px;
      border-radius: 8px;
      font-size: 14px;
    }
    
    .progress-bar {
      width: 100%;
      height: 8px;
      background: #e9ecef;
      border-radius: 4px;
      overflow: hidden;
      margin: 10px 0;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
      transition: width 0.3s ease;
    }
    
    .celebration {
      text-align: center;
      animation: bounce 1s infinite;
    }
    
    @keyframes bounce {
      0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
      40% { transform: translateY(-10px); }
      60% { transform: translateY(-5px); }
    }
    
    .difficulty-indicator {
      display: inline-block;
      padding: 5px 10px;
      border-radius: 15px;
      font-size: 12px;
      font-weight: bold;
      margin: 5px 0;
    }
    
    .easy { background: #d4edda; color: #155724; }
    .medium { background: #fff3cd; color: #856404; }
    .hard { background: #f8d7da; color: #721c24; }
    .extreme { background: #6f42c1; color: white; }
    
    .danger-zone {
      background: linear-gradient(45deg, #dc3545, #fd7e14);
      color: white;
      padding: 10px;
      border-radius: 8px;
      margin: 10px 0;
      text-align: center;
      font-weight: bold;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.7; }
      100% { opacity: 1; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üèõÔ∏è Escape Room Matem√°tico Avan√ßado</h1>
      <p>Miss√£o: Escapar do Museu dos N√∫meros Perdidos!</p>
    </div>
    
    <div class="stats">
      <div>‚è±Ô∏è <span id="timer">00:00</span></div>
      <div>üèÜ <span id="score">0</span> pontos</div>
      <div>üìç Sala <span id="current-room">0</span>/22</div>
    </div>
    
    <div class="penalty-cards">
      <button class="card yellow" onclick="yellowCard()" title="Cart√£o Amarelo - Penaliza√ß√£o (-150 pontos)">
        üü®
      </button>
      <button class="card red" onclick="redCard()" title="Cart√£o Vermelho - Reiniciar Jogo">
        üü•
      </button>
    </div>
    
    <div class="progress-bar">
      <div class="progress-fill" id="progress" style="width: 0%"></div>
    </div>

    <div id="penalty-alert" style="display: none;"></div>

    <!-- Sala 0: Configura√ß√£o da Equipa -->
    <div id="room0" class="room active team-setup">
      <h2>üéØ Bem-vindos, Exploradores Matem√°ticos!</h2>
      <p>Est√£o presos no misterioso Museu dos N√∫meros Perdidos! Para escapar, ter√£o de resolver 22 desafios matem√°ticos progressivamente mais dif√≠ceis.</p>
      <input type="text" id="team-name" placeholder="Nome da vossa equipa" maxlength="20">
      <button class="btn" onclick="startGame()">üöÄ Come√ßar Aventura √âpica!</button>
      <div class="hint">
        ‚ö†Ô∏è <strong>ATEN√á√ÉO:</strong> A partir da sala 10, cada erro faz-vos recuar aleatoriamente!
      </div>
      <div class="danger-zone">
        üî• MODO INTENSIVO: Pontos perdidos por cada erro!
      </div>
    </div>

    <!-- Sala 1: N√∫meros Naturais -->
    <div id="room1" class="room">
      <h2>üî¢ Sala 1: Portal dos N√∫meros Simples</h2>
      <div class="difficulty-indicator easy">F√ÅCIL</div>
      <div class="question">
        <p id="question1">47 + 38 = ?</p>
      </div>
      <input type="number" id="answer1" class="answer-input" placeholder="Resposta">
      <button class="btn" onclick="checkAnswer(1)">Submeter Resposta</button>
      <div id="feedback1" class="feedback"></div>
      <div class="hint">üí° <strong>Dica:</strong> Decomponha: 47 + 30 + 8</div>
    </div>

    <!-- Sala 2: Subtra√ß√£o Complexa -->
    <div id="room2" class="room">
      <h2>üö™ Sala 2: C√¢mara da Subtra√ß√£o</h2>
      <div class="difficulty-indicator easy">F√ÅCIL</div>
      <div class="question">
        <p id="question2">205 - 87 = ?</p>
      </div>
      <input type="number" id="answer2" class="answer-input" placeholder="Resposta">
      <button class="btn" onclick="checkAnswer(2)">Submeter Resposta</button>
      <div id="feedback2" class="feedback"></div>
      <div class="hint">üí° <strong>Dica:</strong> 205 - 90 + 3</div>
    </div>

    <!-- Sala 3: Multiplica√ß√£o -->
    <div id="room3" class="room">
      <h2>‚ö° Sala 3: Laborat√≥rio da Multiplica√ß√£o</h2>
      <div class="difficulty-indicator medium">M√âDIO</div>
      <div class="question">
        <p id="question3">13 √ó 7 = ?</p>
      </div>
      <input type="number" id="answer3" class="answer-input" placeholder="Resposta">
      <button class="btn" onclick="checkAnswer(3)">Submeter Resposta</button>
      <div id="feedback3" class="feedback"></div>
      <div class="hint">üí° <strong>Dica:</strong> 13 √ó 7 = 10 √ó 7 + 3 √ó 7</div>
    </div>

    <!-- Sala 4: Divis√£o com Resto -->
    <div id="room4" class="room">
      <h2>üîç Sala 4: Enigma da Divis√£o</h2>
      <div class="difficulty-indicator medium">M√âDIO</div>
      <div class="question">
        <p id="question4">127 √∑ 8 = ? (qual √© o quociente?)</p>
      </div>
      <input type="number" id="answer4" class="answer-input" placeholder="S√≥ o quociente">
      <button class="btn" onclick="checkAnswer(4)">Submeter Resposta</button>
      <div id="feedback4" class="feedback"></div>
      <div class="hint">üí° <strong>Dica:</strong> Quantas vezes o 8 cabe no 127?</div>
    </div>

    <!-- Sala 5: Fra√ß√µes Equivalentes -->
    <div id="room5" class="room">
      <h2>üçï Sala 5: Galeria das Fra√ß√µes</h2>
      <div class="difficulty-indicator medium">M√âDIO</div>
      <div class="question">
        <p id="question5">Qual destas fra√ß√µes √© equivalente a 2/3?</p>
        <p>A) 4/6   B) 3/4   C) 6/8   D) 5/9</p>
      </div>
      <input type="text" id="answer5" class="answer-input" placeholder="Digite A, B, C ou D">
      <button class="btn" onclick="checkAnswer(5)">Submeter Resposta</button>
      <div id="feedback5" class="feedback"></div>
      <div class="hint">üí° <strong>Dica:</strong> Multiplique numerador e denominador pelo mesmo n√∫mero</div>
    </div>

    <!-- Sala 6: Per√≠metros Complexos -->
    <div id="room6" class="room">
      <h2>üìê Sala 6: Atelier de Geometria Avan√ßada</h2>
      <div class="difficulty-indicator medium">M√âDIO</div>
      <div class="question">
        <p id="question6">Um ret√¢ngulo tem 15 cm de comprimento e 9 cm de largura. Qual √© o seu per√≠metro?</p>
      </div>
      <input type="number" id="answer6" class="answer-input" placeholder="Resposta em cm">
      <button class="btn" onclick="checkAnswer(6)">Submeter Resposta</button>
      <div id="feedback6" class="feedback"></div>
      <div class="hint">üí° <strong>Dica:</strong> Per√≠metro = 2 √ó (comprimento + largura)</div>
    </div>

    <!-- Sala 7: Problemas de Dinheiro -->
    <div id="room7" class="room">
      <h2>üí∞ Sala 7: Banco dos Problemas</h2>
      <div class="difficulty-indicator medium">M√âDIO</div>
      <div class="question">
        <p id="question7">O Pedro comprou 4 livros por 8,75‚Ç¨ cada e pagou com uma nota de 50‚Ç¨. Quanto recebeu de troco?</p>
      </div>
      <input type="number" id="answer7" class="answer-input" placeholder="Resposta em euros" step="0.01">
      <button class="btn" onclick="checkAnswer(7)">Submeter Resposta</button>
      <div id="feedback7" class="feedback"></div>
      <div class="hint">üí° <strong>Dica:</strong> Troco = Dinheiro pago - Custo total</div>
    </div>

    <!-- Sala 8: √Åreas -->
    <div id="room8" class="room">
      <h2>üìè Sala 8: Medidor de Superf√≠cies</h2>
      <div class="difficulty-indicator hard">DIF√çCIL</div>
      <div class="question">
        <p id="question8">Qual √© a √°rea de um quadrado com 12 cm de lado?</p>
      </div>
      <input type="number" id="answer8" class="answer-input" placeholder="Resposta em cm¬≤">
      <button class="btn" onclick="checkAnswer(8)">Submeter Resposta</button>
      <div id="feedback8" class="feedback"></div>
      <div class="hint">üí° <strong>Dica:</strong> √Årea do quadrado = lado √ó lado</div>
    </div>

    <!-- Sala 9: N√∫meros Decimais -->
    <div id="room9" class="room">
      <h2>üî∏ Sala 9: Reino dos Decimais</h2>
      <div class="difficulty-indicator hard">DIF√çCIL</div>
      <div class="question">
        <p id="question9">3,7 + 2,85 + 1,049 = ?</p>
      </div>
      <input type="number" id="answer9" class="answer-input" placeholder="Resposta" step="0.001">
      <button class="btn" onclick="checkAnswer(9)">Submeter Resposta</button>
      <div id="feedback9" class="feedback"></div>
      <div class="hint">üí° <strong>Dica:</strong> Alinha as casas decimais para somar</div>
    </div>

    <!-- A partir daqui √© ZONA PERIGOSA (Sala 10+) -->
    <div id="room10" class="room">
      <h2>‚ö†Ô∏è Sala 10: ZONA PERIGOSA - Fra√ß√µes Complexas</h2>
      <div class="difficulty-indicator hard">DIF√çCIL</div>
      <div class="danger-zone">üî• CUIDADO: Erros fazem-vos recuar!</div>
      <div class="question">
        <p id="question10">3/4 + 2/8 = ? (simplifique a resposta)</p>
      </div>
      <input type="text" id="answer10" class="answer-input" placeholder="Ex: 5/4">
      <button class="btn" onclick="checkAnswer(10)">Submeter Resposta</button>
      <div id="feedback10" class="feedback"></div>
      <div class="hint">üí° <strong>Dica:</strong> Primeiro converta 2/8 = 1/4</div>
    </div>

    <!-- Sala 11: Percentagens -->
    <div id="room11" class="room">
      <h2>üìä Sala 11: Centro das Percentagens</h2>
      <div class="difficulty-indicator hard">DIF√çCIL</div>
      <div class="danger-zone">‚ö° ZONA PERIGOSA ATIVA</div>
      <div class="question">
        <p id="question11">Numa turma de 25 alunos, 60% s√£o raparigas. Quantas raparigas h√°?</p>
      </div>
      <input type="number" id="answer11" class="answer-input" placeholder="N√∫mero de raparigas">
      <button class="btn" onclick="checkAnswer(11)">Submeter Resposta</button>
      <div id="feedback11" class="feedback"></div>
      <div class="hint">üí° <strong>Dica:</strong> 60% = 60/100 = 0,6</div>
    </div>

    <!-- Sala 12: Sequ√™ncias Avan√ßadas -->
    <div id="room12" class="room">
      <h2>üåÄ Sala 12: Labirinto das Sequ√™ncias</h2>
      <div class="difficulty-indicator extreme">EXTREMO</div>
      <div class="danger-zone">üíÄ ZONA MORTAL</div>
      <div class="question">
        <p id="question12">1, 4, 9, 16, 25, __, 49. Qual √© o n√∫mero em falta?</p>
      </div>
      <input type="number" id="answer12" class="answer-input" placeholder="Resposta">
      <button class="btn" onclick="checkAnswer(12)">Submeter Resposta</button>
      <div id="feedback12" class="feedback"></div>
      <div class="hint">üí° <strong>Dica:</strong> S√£o quadrados perfeitos: 1¬≤, 2¬≤, 3¬≤...</div>
    </div>

    <!-- Sala 13: Opera√ß√µes Mistas -->
    <div id="room13" class="room">
      <h2>üß™ Sala 13: Laborat√≥rio das Opera√ß√µes Mistas</h2>
      <div class="difficulty-indicator extreme">EXTREMO</div>
      <div class="danger-zone">üî• CALDEIR√ÉO MATEM√ÅTICO</div>
      <div class="question">
        <p id="question13">(24 + 16) √∑ 8 √ó 3 - 5 = ?</p>
      </div>
      <input type="number" id="answer13" class="answer-input" placeholder="Resposta">
      <button class="btn" onclick="checkAnswer(13)">Submeter Resposta</button>
      <div id="feedback13" class="feedback"></div>
      <div class="hint">üí° <strong>Dica:</strong> Ordem: par√™nteses, √ó√∑ (esquerda‚Üídireita), ¬±</div>
    </div>

    <!-- Sala 14: Problemas de Tempo -->
    <div id="room14" class="room">
      <h2>‚è∞ Sala 14: M√°quina do Tempo</h2>
      <div class="difficulty-indicator extreme">EXTREMO</div>
      <div class="danger-zone">‚ö° DISTOR√á√ÉO TEMPORAL</div>
      <div class="question">
        <p id="question14">Um filme come√ßou √†s 19:45 e durou 2h 35min. A que horas terminou?</p>
      </div>
      <input type="text" id="answer14" class="answer-input" placeholder="Ex: 22:20">
      <button class="btn" onclick="checkAnswer(14)">Submeter Resposta</button>
      <div id="feedback14" class="feedback"></div>
      <div class="hint">üí° <strong>Dica:</strong> Some horas e minutos separadamente</div>
    </div>

    <!-- Sala 15: M√∫ltiplos e Divisores -->
    <div id="room15" class="room">
      <h2>üî¢ Sala 15: C√¢mara dos M√∫ltiplos</h2>
      <div class="difficulty-indicator extreme">EXTREMO</div>
      <div class="danger-zone">üå™Ô∏è V√ìRTICE NUM√âRICO</div>
      <div class="question">
        <p id="question15">Qual √© o menor m√∫ltiplo comum de 12 e 18?</p>
      </div>
      <input type="number" id="answer15" class="answer-input" placeholder="Resposta">
      <button class="btn" onclick="checkAnswer(15)">Submeter Resposta</button>
      <div id="feedback15" class="feedback"></div>
      <div class="hint">üí° <strong>Dica:</strong> Liste os m√∫ltiplos de cada n√∫mero</div>
    </div>

    <!-- Sala 16: Problemas de Velocidade -->
    <div id="room16" class="room">
      <h2>üèÉ Sala 16: Pista da Velocidade</h2>
      <div class="difficulty-indicator extreme">EXTREMO</div>
      <div class="danger-zone">üí® CORRIDA CONTRA O TEMPO</div>
      <div class="question">
        <p id="question16">Um carro percorre 240 km em 3 horas. Qual √© a sua velocidade m√©dia?</p>
      </div>
      <input type="number" id="answer16" class="answer-input" placeholder="km/h">
      <button class="btn" onclick="checkAnswer(16)">Submeter Resposta</button>
      <div id="feedback16" class="feedback"></div>
      <div class="hint">üí° <strong>Dica:</strong> Velocidade = Dist√¢ncia √∑ Tempo</div>
    </div>

    <!-- Sala 17: Geometria 3D -->
    <div id="room17" class="room">
      <h2>üì¶ Sala 17: Dimens√£o C√∫bica</h2>
      <div class="difficulty-indicator extreme">EXTREMO</div>
      <div class="danger-zone">üé≤ CUBO M√ÅGICO</div>
      <div class="question">
        <p id="question17">Quantas faces tem um cubo?</p>
      </div>
      <input type="number" id="answer17" class="answer-input" placeholder="N√∫mero de faces">
      <button class="btn" onclick="checkAnswer(17)">Submeter Resposta</button>
      <div id="feedback17" class="feedback"></div>
      <div class="hint">üí° <strong>Dica:</strong> Pense num dado</div>
    </div>

    <!-- Sala 18: Equa√ß√µes Simples -->
    <div id="room18" class="room">
      <h2>‚öñÔ∏è Sala 18: Balan√ßa da Justi√ßa</h2>
      <div class="difficulty-indicator extreme">EXTREMO</div>
      <div class="danger-zone">‚öñÔ∏è EQUIL√çBRIO PERFEITO</div>
      <div class="question">
        <p id="question18">x + 15 = 23. Quanto vale x?</p>
      </div>
      <input type="number" id="answer18" class="answer-input" placeholder="Valor de x">
      <button class="btn" onclick="checkAnswer(18)">Submeter Resposta</button>
      <div id="feedback18" class="feedback"></div>
      <div class="hint">üí° <strong>Dica:</strong> x = 23 - 15</div>
    </div>

    <!-- Sala 19: Estat√≠stica -->
    <div id="room19" class="room">
      <h2>üìà Sala 19: Centro de Dados</h2>
      <div class="difficulty-indicator extreme">EXTREMO</div>
      <div class="danger-zone">üìä AN√ÅLISE CR√çTICA</div>
      <div class="question">
        <p id="question19">As idades de 5 amigos s√£o: 10, 12, 9, 11, 13. Qual √© a m√©dia das idades?</p>
      </div>
      <input type="number" id="answer19" class="answer-input" placeholder="M√©dia">
      <button class="btn" onclick="checkAnswer(19)">Submeter Resposta</button>
      <div id="feedback19" class="feedback"></div>
      <div class="hint">üí° <strong>Dica:</strong> M√©dia = (soma de todos) √∑ (quantidade)</div>
    </div>

    <!-- Sala 20: Probabilidade -->
    <div id="room20" class="room">
      <h2>üé≤ Sala 20: Casino da Probabilidade</h2>
      <div class="difficulty-indicator extreme">EXTREMO</div>
      <div class="danger-zone">üçÄ JOGOS DO DESTINO</div>
      <div class="question">
        <p id="question20">Qual √© a probabilidade de sair cara ao lan√ßar uma moeda? (em fra√ß√£o)</p>
      </div>
      <input type="text" id="answer20" class="answer-input" placeholder="Ex: 1/2">
      <button class="btn" onclick="checkAnswer(20)">Submeter Resposta</button>
      <div id="feedback20" class="feedback"></div>
      <div class="hint">üí° <strong>Dica:</strong> 1 resultado favor√°vel em 2 poss√≠veis</div>
    </div>

    <!-- Sala 21: Desafio Final -->
    <div id="room21" class="room">
      <h2>üëë Sala 21: Trono do Conhecimento</h2>
      <div class="difficulty-indicator extreme">LEGENDARY</div>
      <div class="danger-zone">üëë DESAFIO SUPREMO</div>
      <div class="question">
        <p id="question21">Um aqu√°rio tem forma de paralelep√≠pedo com 50cm de comprimento, 30cm de largura e 40cm de altura. Quantos litros de √°gua cabem? (1 litro = 1000 cm¬≥)</p>
      </div>
      <input type="number" id="answer21" class="answer-input" placeholder="Litros">
      <button class="btn" onclick="checkAnswer(21)">Submeter Resposta</button>
      <div id="feedback21" class="feedback"></div>
      <div class="hint">üí° <strong>Dica:</strong> Volume = comprimento √ó largura √ó altura</div>
    </div>

    <!-- Sala 22: Enigma dos Mestres -->
    <div id="room22" class="room">
      <h2>üßô Sala 22: Enigma dos Mestres Matem√°ticos</h2>
      <div class="difficulty-indicator extreme">LEGENDARY</div>
      <div class="danger-zone">üîÆ MAGIA PURA</div>
      <div class="question">
        <p id="question22">Pensando em um n√∫mero. Se somar 12, multiplicar por 3 e subtrair 21, obtenho 24. Que n√∫mero pensei?</p>
      </div>
      <input type="number" id="answer22" class="answer-input" placeholder="O n√∫mero pensado">
      <button class="btn" onclick="checkAnswer(22)">Submeter Resposta</button>
      <div id="feedback22" class="feedback"></div>
      <div class="hint">üí° <strong>Dica:</strong> Trabalhe para tr√°s: (24 + 21) √∑ 3 - 12</div>
    </div>

    <!-- Sala Final: Celebra√ß√£o -->
    <div id="room23" class="room celebration">
      <h2>üéâ VIT√ìRIA √âPICA!</h2>
      <p style="font-size: 24px;">üëëüèÜüéä</p>
      <p><strong id="team-display"></strong></p>
      <p>Escaparam do Museu dos N√∫meros Perdidos!</p>
      <div style="margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 10px;">
        <p><strong>Pontua√ß√£o Final:</strong> <span id="final-score"></span> pontos</p>
        <p><strong>Tempo Total:</strong> <span id="final-time"></span></p>
        <p><strong>Classifica√ß√£o:</strong> <span id="rating"></span></p>
        <p><strong>Recuos Sofridos:</strong> <span id="total-backtracks"></span></p>
      </div>
      <button class="btn" onclick="restartGame()">üîÑ Nova Aventura</button>
    </div>
  </div>

  <script>
    let currentRoom = 0;
    let score = 0;
    let startTime = Date.now();
    let teamName = "";
    let roomStartTime = Date.now();
    let attempts = {};
    let timerInterval;
    let totalBacktracks = 0;
    
    // Inicializar tentativas para cada sala
    for(let i = 1; i <= 22; i++) {
      attempts[i] = 0;
    }
    
    // Banco de perguntas expandido
    let questions = {
      1: [
        { question: "47 + 38 = ?", answer: 85 },
        { question: "56 + 29 = ?", answer: 85 },
        { question: "73 + 12 = ?", answer: 85 }
      ],
      2: [
        { question: "205 - 87 = ?", answer: 118 },
        { question: "304 - 186 = ?", answer: 118 },
        { question: "250 - 132 = ?", answer: 118 }
      ],
      3: [
        { question: "13 √ó 7 = ?", answer: 91 },
        { question: "14 √ó 6 = ?", answer: 84 },
        { question: "12 √ó 8 = ?", answer: 96 }
      ],
      4: [
        { question: "127 √∑ 8 = ? (qual √© o quociente?)", answer: 15 },
        { question: "143 √∑ 9 = ? (qual √© o quociente?)", answer: 15 },
        { question: "135 √∑ 9 = ? (qual √© o quociente?)", answer: 15 }
      ],
      5: [
        { question: "Qual destas fra√ß√µes √© equivalente a 2/3?\nA) 4/6   B) 3/4   C) 6/8   D) 5/9", answer: "A" },
        { question: "Qual destas fra√ß√µes √© equivalente a 3/4?\nA) 6/9   B) 6/8   C) 4/5   D) 7/8", answer: "B" },
        { question: "Qual destas fra√ß√µes √© equivalente a 1/2?\nA) 2/3   B) 3/6   C) 4/7   D) 5/9", answer: "B" }
      ],
      6: [
        { question: "Um ret√¢ngulo tem 15 cm de comprimento e 9 cm de largura. Qual √© o seu per√≠metro?", answer: 48 },
        { question: "Um ret√¢ngulo tem 18 cm de comprimento e 7 cm de largura. Qual √© o seu per√≠metro?", answer: 50 },
        { question: "Um ret√¢ngulo tem 14 cm de comprimento e 11 cm de largura. Qual √© o seu per√≠metro?", answer: 50 }
      ],
      7: [
        { question: "O Pedro comprou 4 livros por 8,75‚Ç¨ cada e pagou com uma nota de 50‚Ç¨. Quanto recebeu de troco?", answer: 15.00 },
        { question: "A Ana comprou 3 brinquedos por 12,50‚Ç¨ cada e pagou com uma nota de 50‚Ç¨. Quanto recebeu de troco?", answer: 12.50 },
        { question: "O Jo√£o comprou 5 canetas por 2,80‚Ç¨ cada e pagou com uma nota de 20‚Ç¨. Quanto recebeu de troco?", answer: 6.00 }
      ],
      8: [
        { question: "Qual √© a √°rea de um quadrado com 12 cm de lado?", answer: 144 },
        { question: "Qual √© a √°rea de um quadrado com 15 cm de lado?", answer: 225 },
        { question: "Qual √© a √°rea de um quadrado com 11 cm de lado?", answer: 121 }
      ],
      9: [
        { question: "3,7 + 2,85 + 1,049 = ?", answer: 7.599 },
        { question: "4,2 + 1,75 + 2,033 = ?", answer: 7.983 },
        { question: "5,1 + 0,84 + 1,672 = ?", answer: 7.612 }
      ],
      10: [
        { question: "3/4 + 2/8 = ? (simplifique a resposta)", answer: "1/1" },
        { question: "2/3 + 1/6 = ? (simplifique a resposta)", answer: "5/6" },
        { question: "1/2 + 3/8 = ? (simplifique a resposta)", answer: "7/8" }
      ],
      11: [
        { question: "Numa turma de 25 alunos, 60% s√£o raparigas. Quantas raparigas h√°?", answer: 15 },
        { question: "Numa escola de 200 alunos, 35% s√£o do 5¬∫ ano. Quantos alunos do 5¬∫ ano h√°?", answer: 70 },
        { question: "Num parque de 80 √°rvores, 25% s√£o carvalhos. Quantos carvalhos h√°?", answer: 20 }
      ],
      12: [
        { question: "1, 4, 9, 16, 25, __, 49. Qual √© o n√∫mero em falta?", answer: 36 },
        { question: "2, 8, 18, 32, 50, __. Qual √© o pr√≥ximo n√∫mero?", answer: 72 },
        { question: "1, 8, 27, 64, __. Qual √© o pr√≥ximo n√∫mero?", answer: 125 }
      ],
      13: [
        { question: "(24 + 16) √∑ 8 √ó 3 - 5 = ?", answer: 10 },
        { question: "(18 + 12) √∑ 6 √ó 4 - 8 = ?", answer: 12 },
        { question: "(35 + 25) √∑ 12 √ó 6 - 15 = ?", answer: 15 }
      ],
      14: [
        { question: "Um filme come√ßou √†s 19:45 e durou 2h 35min. A que horas terminou?", answer: "22:20" },
        { question: "Um espet√°culo come√ßou √†s 20:15 e durou 1h 50min. A que horas terminou?", answer: "22:05" },
        { question: "Uma viagem come√ßou √†s 14:30 e durou 3h 25min. A que horas terminou?", answer: "17:55" }
      ],
      15: [
        { question: "Qual √© o menor m√∫ltiplo comum de 12 e 18?", answer: 36 },
        { question: "Qual √© o menor m√∫ltiplo comum de 6 e 8?", answer: 24 },
        { question: "Qual √© o menor m√∫ltiplo comum de 15 e 20?", answer: 60 }
      ],
      16: [
        { question: "Um carro percorre 240 km em 3 horas. Qual √© a sua velocidade m√©dia?", answer: 80 },
        { question: "Um comboio percorre 450 km em 5 horas. Qual √© a sua velocidade m√©dia?", answer: 90 },
        { question: "Um ciclista percorre 72 km em 4 horas. Qual √© a sua velocidade m√©dia?", answer: 18 }
      ],
      17: [
        { question: "Quantas faces tem um cubo?", answer: 6 },
        { question: "Quantas arestas tem um cubo?", answer: 12 },
        { question: "Quantos v√©rtices tem um cubo?", answer: 8 }
      ],
      18: [
        { question: "x + 15 = 23. Quanto vale x?", answer: 8 },
        { question: "y - 12 = 18. Quanto vale y?", answer: 30 },
        { question: "z + 7 = 25. Quanto vale z?", answer: 18 }
      ],
      19: [
        { question: "As idades de 5 amigos s√£o: 10, 12, 9, 11, 13. Qual √© a m√©dia das idades?", answer: 11 },
        { question: "As notas de um aluno s√£o: 8, 7, 9, 6, 10. Qual √© a m√©dia?", answer: 8 },
        { question: "Os pre√ßos de 4 artigos s√£o: 5‚Ç¨, 8‚Ç¨, 12‚Ç¨, 7‚Ç¨. Qual √© o pre√ßo m√©dio?", answer: 8 }
      ],
      20: [
        { question: "Qual √© a probabilidade de sair cara ao lan√ßar uma moeda? (em fra√ß√£o)", answer: "1/2" },
        { question: "Qual √© a probabilidade de sair 6 ao lan√ßar um dado? (em fra√ß√£o)", answer: "1/6" },
        { question: "Qual √© a probabilidade de tirar uma carta vermelha de um baralho? (em fra√ß√£o)", answer: "1/2" }
      ],
      21: [
        { question: "Um aqu√°rio tem forma de paralelep√≠pedo com 50cm de comprimento, 30cm de largura e 40cm de altura. Quantos litros de √°gua cabem? (1 litro = 1000 cm¬≥)", answer: 60 },
        { question: "Uma caixa tem 40cm √ó 25cm √ó 32cm. Qual √© o seu volume em litros?", answer: 32 },
        { question: "Um recipiente tem 60cm √ó 20cm √ó 25cm. Quantos litros cabem?", answer: 30 }
      ],
      22: [
        { question: "Pensando em um n√∫mero. Se somar 12, multiplicar por 3 e subtrair 21, obtenho 24. Que n√∫mero pensei?", answer: 3 },
        { question: "Pensando em um n√∫mero. Se multiplicar por 4, somar 8 e dividir por 2, obtenho 16. Que n√∫mero pensei?", answer: 6 },
        { question: "Pensando em um n√∫mero. Se somar 5, multiplicar por 2 e subtrair 6, obtenho 14. Que n√∫mero pensei?", answer: 5 }
      ]
    };
    
    let currentQuestions = {};
    
    function updateTimer() {
      const elapsed = Math.floor((Date.now() - startTime) / 1000);
      const minutes = Math.floor(elapsed / 60);
      const seconds = elapsed % 60;
      document.getElementById('timer').textContent = 
        String(minutes).padStart(2, '0') + ':' + String(seconds).padStart(2, '0');
    }
    
    function updateProgress() {
      const progress = (currentRoom / 23) * 100;
      document.getElementById('progress').style.width = progress + '%';
    }
    
    function startGame() {
      teamName = document.getElementById('team-name').value.trim();
      if (!teamName) {
        alert('Por favor, escolham um nome para a vossa equipa!');
        return;
      }
      
      currentRoom = 1;
      startTime = Date.now();
      roomStartTime = Date.now();
      totalBacktracks = 0;
      
      // Escolher perguntas aleat√≥rias para cada sala
      for (let i = 1; i <= 22; i++) {
        let randomIndex = Math.floor(Math.random() * questions[i].length);
        currentQuestions[i] = questions[i][randomIndex];
        
        // Atualizar a interface com a pergunta selecionada
        document.getElementById('question' + i).textContent = questions[i][randomIndex].question;
      }
      
      document.getElementById('room0').classList.remove('active');
      document.getElementById('room1').classList.add('active');
      document.getElementById('current-room').textContent = currentRoom;
      
      updateProgress();
      timerInterval = setInterval(updateTimer, 1000);
    }
    
    function calculatePoints(basePoints, timeBonus = true) {
      let points = basePoints;
      
      // Penalizar tentativas m√∫ltiplas mais severamente
      const attemptPenalty = (attempts[currentRoom] - 1) * 50;
      points = Math.max(points - attemptPenalty, 50);
      
      if (timeBonus) {
        const roomTime = Math.floor((Date.now() - roomStartTime) / 1000);
        if (roomTime <= 20) points += 100; // Bonus maior por rapidez
        else if (roomTime <= 45) points += 60;
        else if (roomTime <= 90) points += 30;
      }
      
      return Math.max(points, 25); // M√≠nimo 25 pontos
    }
    
    function checkAnswer(room) {
      attempts[room] = (attempts[room] || 0) + 1;
      
      let input = document.getElementById('answer' + room).value.trim();
      let feedback = document.getElementById('feedback' + room);
      let isCorrect = false;
      let correctAnswer = currentQuestions[room].answer;
      
      // Verifica√ß√£o espec√≠fica por tipo de resposta
      if (typeof correctAnswer === 'string') {
        if (correctAnswer.includes('/')) {
          // Para fra√ß√µes
          isCorrect = (input === correctAnswer || input.replace(':', '/') === correctAnswer);
        } else if (correctAnswer.includes(':')) {
          // Para tempo
          isCorrect = (input === correctAnswer || 
                      input.replace('h', ':').replace('m', '').replace(' ', '') === correctAnswer);
        } else {
          // Para letras (A, B, C, D)
          isCorrect = (input.toUpperCase() === correctAnswer.toUpperCase());
        }
      } else {
        // Para n√∫meros
        isCorrect = (Math.abs(parseFloat(input) - correctAnswer) < 0.01);
      }
      
      if (isCorrect) {
        // Resposta correta
        const basePoints = [0, 100, 120, 150, 170, 200, 220, 250, 280, 300, 350, 400, 450, 500, 550, 600, 650, 700, 750, 800, 850, 900, 1000][room] || 1000;
        const earnedPoints = calculatePoints(basePoints);
        score += earnedPoints;
        
        feedback.innerHTML = `<div class="success">
          ‚úÖ Correto! +${earnedPoints} pontos<br>
          üöÄ A avan√ßar para a pr√≥xima sala...
        </div>`;
        
        document.getElementById('score').textContent = score;
        
        setTimeout(function() {
          document.getElementById('room' + room).classList.remove('active');
          currentRoom++;
          
          if (currentRoom <= 22) {
            document.getElementById('room' + currentRoom).classList.add('active');
            document.getElementById('current-room').textContent = currentRoom;
            roomStartTime = Date.now();
          } else {
            finishGame();
          }
          
          updateProgress();
        }, 2000);
        
      } else {
        // Resposta incorreta
        let attemptsLeft = 3 - attempts[room];
        
        // Penaliza√ß√£o por erro
        let pointPenalty = Math.min(100, score * 0.1); // 10% da pontua√ß√£o atual, m√°ximo 100
        score = Math.max(0, score - pointPenalty);
        document.getElementById('score').textContent = score;
        
        if (attemptsLeft > 0) {
          feedback.innerHTML = `<div class="error">
            ‚ùå Resposta incorreta! -${Math.floor(pointPenalty)} pontos<br>
            Tens mais ${attemptsLeft} tentativa(s).<br>
            üí° Tenta novamente!
          </div>`;
        } else {
          // Sem mais tentativas
          if (room >= 10) {
            // ZONA PERIGOSA - Recuar aleatoriamente
            let backtrackRooms = Math.floor(Math.random() * 4) + 2; // Recua 2-5 salas
            let newRoom = Math.max(1, currentRoom - backtrackRooms);
            totalBacktracks++;
            
            feedback.innerHTML = `<div class="error">
              ‚ùå Resposta incorreta! A resposta era: ${correctAnswer}<br>
              üî• RECUAS ${backtrackRooms} SALAS! (Sala ${newRoom})
            </div>`;
            
            setTimeout(function() {
              document.getElementById('room' + room).classList.remove('active');
              currentRoom = newRoom;
              document.getElementById('room' + currentRoom).classList.add('active');
              document.getElementById('current-room').textContent = currentRoom;
              roomStartTime = Date.now();
              updateProgress();
              
              showPenaltyMessage(`üíÄ RECUASTE ${backtrackRooms} SALAS! Agora est√°s na sala ${newRoom}!`, "#f8d7da");
            }, 3000);
          } else {
            // Zona normal - apenas avan√ßa
            feedback.innerHTML = `<div class="error">
              ‚ùå Resposta incorreta! A resposta era: ${correctAnswer}<br>
              üöÄ A avan√ßar para a pr√≥xima sala...
            </div>`;
            
            setTimeout(function() {
              document.getElementById('room' + room).classList.remove('active');
              currentRoom++;
              
              if (currentRoom <= 22) {
                document.getElementById('room' + currentRoom).classList.add('active');
                document.getElementById('current-room').textContent = currentRoom;
                roomStartTime = Date.now();
              } else {
                finishGame();
              }
              
              updateProgress();
            }, 3000);
          }
        }
      }
    }
    
    function finishGame() {
      clearInterval(timerInterval);
      
      // Mostrar sala de celebra√ß√£o
      document.getElementById('room23').classList.add('active');
      document.getElementById('team-display').textContent = teamName;
      document.getElementById('final-score').textContent = score;
      document.getElementById('total-backtracks').textContent = totalBacktracks;
      
      const elapsed = Math.floor((Date.now() - startTime) / 1000);
      const minutes = Math.floor(elapsed / 60);
      const seconds = elapsed % 60;
      document.getElementById('final-time').textContent = 
        String(minutes).padStart(2, '0') + ':' + String(seconds).padStart(2, '0');
      
      // Calcular classifica√ß√£o mais rigorosa
      let rating = "";
      if (score >= 8000 && totalBacktracks === 0) rating = "üëë MESTRES SUPREMOS DA MATEM√ÅTICA!";
      else if (score >= 6000 && totalBacktracks <= 1) rating = "üèÜ G√âNIOS MATEM√ÅTICOS!";
      else if (score >= 4500 && totalBacktracks <= 3) rating = "‚≠ê EXCELENTE PERFORMANCE!";
      else if (score >= 3000) rating = "üëç MUITO BOM!";
      else if (score >= 2000) rating = "üòä BOM TRABALHO!";
      else if (score >= 1000) rating = "üí™ CONTINUEM A PRATICAR!";
      else rating = "üìö PRECISAM DE MAIS ESTUDO!";
      
      document.getElementById('rating').textContent = rating;
    }
    
    function yellowCard() {
      score = Math.max(0, score - 150);
      document.getElementById('score').textContent = score;
      
      showPenaltyMessage("üü® Cart√£o Amarelo! -150 pontos", "#fff3cd");
    }
    
    function redCard() {
      if (confirm("Cart√£o Vermelho! Isto ir√° reiniciar o jogo. Tens a certeza?")) {
        restartGame();
      }
    }
    
    function showPenaltyMessage(message, backgroundColor) {
      const alert = document.getElementById('penalty-alert');
      alert.innerHTML = `<div class="penalty-message" style="background: ${backgroundColor};">${message}</div>`;
      alert.style.display = 'block';
      
      setTimeout(() => {
        alert.style.display = 'none';
      }, 4000);
    }
    
    function restartGame() {
      // Reset todas as vari√°veis
      currentRoom = 0;
      score = 0;
      startTime = Date.now();
      roomStartTime = Date.now();
      teamName = "";
      totalBacktracks = 0;
      
      // Reset tentativas
      for(let i = 1; i <= 22; i++) {
        attempts[i] = 0;
      }
      
      // Reset interface
      document.getElementById('score').textContent = '0';
      document.getElementById('current-room').textContent = '0';
      document.getElementById('timer').textContent = '00:00';
      document.getElementById('team-name').value = '';
      document.getElementById('progress').style.width = '0%';
      
      // Limpar todos os feedbacks e inputs
      for(let i = 1; i <= 22; i++) {
        document.getElementById('answer' + i).value = '';
        document.getElementById('feedback' + i).innerHTML = '';
      }
      
      // Esconder todas as salas e mostrar apenas a sala 0
      for(let i = 1; i <= 23; i++) {
        document.getElementById('room' + i).classList.remove('active');
      }
      document.getElementById('room0').classList.add('active');
      
      // Parar timer se estiver a correr
      if (timerInterval) {
        clearInterval(timerInterval);
      }
    }
    
    // Adicionar eventos de teclado
    document.addEventListener('DOMContentLoaded', function() {
      for(let i = 1; i <= 22; i++) {
        document.getElementById('answer' + i).addEventListener('keypress', function(e) {
          if (e.key === 'Enter') {
            checkAnswer(i);
          }
        });
      }
      
      document.getElementById('team-name').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          startGame();
        }
      });
    });
  </script>
</body>
</html>