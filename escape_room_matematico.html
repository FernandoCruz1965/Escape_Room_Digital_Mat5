<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Escape Room MatemÃ¡tico AvanÃ§ado - 5Âº Ano</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Comic Sans MS', cursive, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #333;
      min-height: 100vh;
      padding: 10px;
    }
    
    @media (min-width: 768px) {
      body {
        overflow: hidden;
        height: 100vh;
      }
    }
    
    .container {
      max-width: 400px;
      margin: 0 auto;
      background: white;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      overflow: hidden;
      max-height: calc(100vh - 20px);
    }
    
    .header {
      background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
      color: white;
      padding: 15px;
      text-align: center;
    }
    
    .stats {
      display: flex;
      justify-content: space-between;
      background: #f8f9fa;
      padding: 10px 15px;
      font-size: 14px;
      font-weight: bold;
    }
    
    .penalty-cards {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin: 10px 0;
      background: #f8f9fa;
      padding: 10px;
      border-top: 1px solid #dee2e6;
    }
    
    .card {
      border: none;
      background: none;
      font-size: 2.2em;
      cursor: pointer;
      transition: transform 0.2s;
      padding: 5px;
      border-radius: 5px;
    }
    
    .card:active {
      transform: scale(1.2);
    }
    
    .card.yellow { 
      color: #f7d51d;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
    }
    
    .card.red { 
      color: #e74c3c;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
    }
    
    .card:hover {
      background: rgba(0,0,0,0.1);
    }
    
    .room {
      display: none;
      padding: 20px;
      min-height: 400px;
      max-height: calc(100vh - 250px);
      overflow-y: auto;
    }
    
    .room.active {
      display: block;
    }
    
    .team-setup {
      text-align: center;
    }
    
    .team-setup input {
      width: 100%;
      padding: 15px;
      margin: 15px 0;
      border: 2px solid #ddd;
      border-radius: 10px;
      font-size: 16px;
      text-align: center;
    }
    
    .question {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 10px;
      margin: 15px 0;
      border-left: 4px solid #4ecdc4;
    }
    
    .answer-input {
      width: 100%;
      padding: 15px;
      margin: 10px 0;
      border: 2px solid #ddd;
      border-radius: 10px;
      font-size: 18px;
      text-align: center;
    }
    
    .btn {
      width: 100%;
      padding: 15px;
      background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      margin: 10px 0;
      transition: transform 0.2s;
    }
    
    .btn:hover {
      transform: scale(1.05);
    }
    
    .btn:disabled {
      background: #ccc;
      transform: none;
    }
    
    .feedback {
      margin: 15px 0;
      padding: 10px;
      border-radius: 8px;
      text-align: center;
      font-weight: bold;
    }
    
    .success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    
    .error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    
    .warning {
      background: #fff3cd;
      color: #856404;
      border: 1px solid #ffeaa7;
    }
    
    .penalty-message {
      background: #fff3cd;
      color: #856404;
      border: 1px solid #ffeaa7;
      margin: 10px 0;
      padding: 15px;
      border-radius: 8px;
      text-align: center;
      font-weight: bold;
      animation: shake 0.5s;
    }
    
    .retrograde-message {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
      margin: 10px 0;
      padding: 15px;
      border-radius: 8px;
      text-align: center;
      font-weight: bold;
      animation: shake 0.8s;
    }
    
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }
    
    .hint {
      background: #fff3cd;
      color: #856404;
      border: 1px solid #ffeaa7;
      margin: 10px 0;
      padding: 10px;
      border-radius: 8px;
      font-size: 14px;
    }
    
    .progress-bar {
      width: 100%;
      height: 8px;
      background: #e9ecef;
      border-radius: 4px;
      overflow: hidden;
      margin: 10px 0;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
      transition: width 0.3s ease;
    }
    
    .celebration {
      text-align: center;
      animation: bounce 1s infinite;
    }
    
    @keyframes bounce {
      0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
      40% { transform: translateY(-10px); }
      60% { transform: translateY(-5px); }
    }
    
    .difficulty-indicator {
      display: inline-block;
      padding: 5px 10px;
      border-radius: 15px;
      font-size: 12px;
      font-weight: bold;
      margin: 5px 0;
    }
    
    .easy { background: #d4edda; color: #155724; }
    .medium { background: #fff3cd; color: #856404; }
    .hard { background: #f8d7da; color: #721c24; }
    .extreme { background: #6f42c1; color: white; }
    
    .danger-zone {
      background: linear-gradient(45deg, #dc3545, #fd7e14);
      color: white;
      padding: 10px;
      border-radius: 8px;
      margin: 10px 0;
      text-align: center;
      font-weight: bold;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.7; }
      100% { opacity: 1; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ›ï¸ Escape Room MatemÃ¡tico AvanÃ§ado</h1>
      <p>MissÃ£o: Escapar do Museu dos NÃºmeros Perdidos!</p>
    </div>
    
    <div class="stats">
      <div>â±ï¸ <span id="timer">00:00</span></div>
      <div>ğŸ† <span id="score">0</span> pontos</div>
      <div>ğŸ“ Sala <span id="current-room">0</span>/22</div>
    </div>
    
    <div class="penalty-cards">
      <button class="card yellow" onclick="yellowCard()" title="CartÃ£o Amarelo - PenalizaÃ§Ã£o (-150 pontos)">
        ğŸŸ¨
      </button>
      <button class="card red" onclick="redCard()" title="CartÃ£o Vermelho - Reiniciar Jogo">
        ğŸŸ¥
      </button>
    </div>
    
    <div class="progress-bar">
      <div class="progress-fill" id="progress" style="width: 0%"></div>
    </div>

    <div id="penalty-alert" style="display: none;"></div>

    <!-- Sala 0: ConfiguraÃ§Ã£o da Equipa -->
    <div id="room0" class="room active team-setup">
      <h2>ğŸ¯ Bem-vindos, Exploradores MatemÃ¡ticos!</h2>
      <p>EstÃ£o presos no misterioso Museu dos NÃºmeros Perdidos! Para escapar, terÃ£o de resolver 22 desafios matemÃ¡ticos progressivamente mais difÃ­ceis.</p>
      <input type="text" id="team-name" placeholder="Nome da vossa equipa" maxlength="20">
      <button class="btn" onclick="startGame()">ğŸš€ ComeÃ§ar Aventura Ã‰pica!</button>
      <div class="hint">
        âš ï¸ <strong>ATENÃ‡ÃƒO:</strong> A partir da sala 10, cada erro faz-vos recuar aleatoriamente!
      </div>
      <div class="danger-zone">
        ğŸ”¥ MODO INTENSIVO: Pontos perdidos por cada erro!
      </div>
    </div>

    <!-- Sala 1: NÃºmeros Naturais -->
    <div id="room1" class="room">
      <h2>ğŸ”¢ Sala 1: Portal dos NÃºmeros Simples</h2>
      <div class="difficulty-indicator easy">FÃCIL</div>
      <div class="question">
        <p id="question1">47 + 38 = ?</p>
      </div>
      <input type="number" id="answer1" class="answer-input" placeholder="Resposta">
      <button class="btn" onclick="checkAnswer(1)">Submeter Resposta</button>
      <div id="feedback1" class="feedback"></div>
      <div class="hint">ğŸ’¡ <strong>Dica:</strong> Decomponha: 47 + 30 + 8</div>
    </div>

    <!-- Sala 2: SubtraÃ§Ã£o Complexa -->
    <div id="room2" class="room">
      <h2>ğŸšª Sala 2: CÃ¢mara da SubtraÃ§Ã£o</h2>
      <div class="difficulty-indicator easy">FÃCIL</div>
      <div class="question">
        <p id="question2">205 - 87 = ?</p>
      </div>
      <input type="number" id="answer2" class="answer-input" placeholder="Resposta">
      <button class="btn" onclick="checkAnswer(2)">Submeter Resposta</button>
      <div id="feedback2" class="feedback"></div>
      <div class="hint">ğŸ’¡ <strong>Dica:</strong> 205 - 90 + 3</div>
    </div>

    <!-- Sala 3: MultiplicaÃ§Ã£o -->
    <div id="room3" class="room">
      <h2>âš¡ Sala 3: LaboratÃ³rio da MultiplicaÃ§Ã£o</h2>
      <div class="difficulty-indicator medium">MÃ‰DIO</div>
      <div class="question">
        <p id="question3">13 Ã— 7 = ?</p>
      </div>
      <input type="number" id="answer3" class="answer-input" placeholder="Resposta">
      <button class="btn" onclick="checkAnswer(3)">Submeter Resposta</button>
      <div id="feedback3" class="feedback"></div>
      <div class="hint">ğŸ’¡ <strong>Dica:</strong> 13 Ã— 7 = 10 Ã— 7 + 3 Ã— 7</div>
    </div>

    <!-- Sala 4: DivisÃ£o com Resto -->
    <div id="room4" class="room">
      <h2>ğŸ” Sala 4: Enigma da DivisÃ£o</h2>
      <div class="difficulty-indicator medium">MÃ‰DIO</div>
      <div class="question">
        <p id="question4">127 Ã· 8 = ? (qual Ã© o quociente?)</p>
      </div>
      <input type="number" id="answer4" class="answer-input" placeholder="SÃ³ o quociente">
      <button class="btn" onclick="checkAnswer(4)">Submeter Resposta</button>
      <div id="feedback4" class="feedback"></div>
      <div class="hint">ğŸ’¡ <strong>Dica:</strong> Quantas vezes o 8 cabe no 127?</div>
    </div>

    <!-- Sala 5: FraÃ§Ãµes Equivalentes -->
    <div id="room5" class="room">
      <h2>ğŸ• Sala 5: Galeria das FraÃ§Ãµes</h2>
      <div class="difficulty-indicator medium">MÃ‰DIO</div>
      <div class="question">
        <p id="question5">Qual destas fraÃ§Ãµes Ã© equivalente a 2/3?</p>
        <p>A) 4/6   B) 3/4   C) 6/8   D) 5/9</p>
      </div>
      <input type="text" id="answer5" class="answer-input" placeholder="Digite A, B, C ou D">
      <button class="btn" onclick="checkAnswer(5)">Submeter Resposta</button>
      <div id="feedback5" class="feedback"></div>
      <div class="hint">ğŸ’¡ <strong>Dica:</strong> Multiplique numerador e denominador pelo mesmo nÃºmero</div>
    </div>

    <!-- Sala 6: PerÃ­metros Complexos -->
    <div id="room6" class="room">
      <h2>ğŸ“ Sala 6: Atelier de Geometria AvanÃ§ada</h2>
      <div class="difficulty-indicator medium">MÃ‰DIO</div>
      <div class="question">
        <p id="question6">Um retÃ¢ngulo tem 15 cm de comprimento e 9 cm de largura. Qual Ã© o seu perÃ­metro?</p>
      </div>
      <input type="number" id="answer6" class="answer-input" placeholder="Resposta em cm">
      <button class="btn" onclick="checkAnswer(6)">Submeter Resposta</button>
      <div id="feedback6" class="feedback"></div>
      <div class="hint">ğŸ’¡ <strong>Dica:</strong> PerÃ­metro = 2 Ã— (comprimento + largura)</div>
    </div>

    <!-- Sala 7: Problemas de Dinheiro -->
    <div id="room7" class="room">
      <h2>ğŸ’° Sala 7: Banco dos Problemas</h2>
      <div class="difficulty-indicator medium">MÃ‰DIO</div>
      <div class="question">
        <p id="question7">O Pedro comprou 4 livros por 8,75â‚¬ cada e pagou com uma nota de 50â‚¬. Quanto recebeu de troco?</p>
      </div>
      <input type="number" id="answer7" class="answer-input" placeholder="Resposta em euros" step="0.01">
      <button class="btn" onclick="checkAnswer(7)">Submeter Resposta</button>
      <div id="feedback7" class="feedback"></div>
      <div class="hint">ğŸ’¡ <strong>Dica:</strong> Troco = Dinheiro pago - Custo total</div>
    </div>

    <!-- Sala 8: Ãreas -->
    <div id="room8" class="room">
      <h2>ğŸ“ Sala 8: Medidor de SuperfÃ­cies</h2>
      <div class="difficulty-indicator hard">DIFÃCIL</div>
      <div class="question">
        <p id="question8">Qual Ã© a Ã¡rea de um quadrado com 12 cm de lado?</p>
      </div>
      <input type="number" id="answer8" class="answer-input" placeholder="Resposta em cmÂ²">
      <button class="btn" onclick="checkAnswer(8)">Submeter Resposta</button>
      <div id="feedback8" class="feedback"></div>
      <div class="hint">ğŸ’¡ <strong>Dica:</strong> Ãrea do quadrado = lado Ã— lado</div>
    </div>

    <!-- Sala 9: NÃºmeros Decimais -->
    <div id="room9" class="room">
      <h2>ğŸ”¸ Sala 9: Reino dos Decimais</h2>
      <div class="difficulty-indicator hard">DIFÃCIL</div>
      <div class="question">
        <p id="question9">3,7 + 2,85 + 1,049 = ?</p>
      </div>
      <input type="number" id="answer9" class="answer-input" placeholder="Resposta" step="0.001">
      <button class="btn" onclick="checkAnswer(9)">Submeter Resposta</button>
      <div id="feedback9" class="feedback"></div>
      <div class="hint">ğŸ’¡ <strong>Dica:</strong> Alinha as casas decimais para somar</div>
    </div>

    <!-- A partir daqui Ã© ZONA PERIGOSA (Sala 10+) -->
    <div id="room10" class="room">
      <h2>âš ï¸ Sala 10: ZONA PERIGOSA - FraÃ§Ãµes Complexas</h2>
      <div class="difficulty-indicator hard">DIFÃCIL</div>
      <div class="danger-zone">ğŸ”¥ CUIDADO: Erros fazem-vos recuar!</div>
      <div class="question">
        <p id="question10">3/4 + 2/8 = ? (simplifique a resposta)</p>
      </div>
      <input type="text" id="answer10" class="answer-input" placeholder="Ex: 5/4">
      <button class="btn" onclick="checkAnswer(10)">Submeter Resposta</button>
      <div id="feedback10" class="feedback"></div>
      <div class="hint">ğŸ’¡ <strong>Dica:</strong> Primeiro converta 2/8 = 1/4</div>
    </div>

    <!-- Sala 11: Percentagens -->
    <div id="room11" class="room">
      <h2>ğŸ“Š Sala 11: Centro das Percentagens</h2>
      <div class="difficulty-indicator hard">DIFÃCIL</div>
      <div class="danger-zone">âš¡ ZONA PERIGOSA ATIVA</div>
      <div class="question">
        <p id="question11">Numa turma de 25 alunos, 60% sÃ£o raparigas. Quantas raparigas hÃ¡?</p>
      </div>
      <input type="number" id="answer11" class="answer-input" placeholder="NÃºmero de raparigas">
      <button class="btn" onclick="checkAnswer(11)">Submeter Resposta</button>
      <div id="feedback11" class="feedback"></div>
      <div class="hint">ğŸ’¡ <strong>Dica:</strong> 60% = 60/100 = 0,6</div>
    </div>

    <!-- Sala 12: SequÃªncias AvanÃ§adas -->
    <div id="room12" class="room">
      <h2>ğŸŒ€ Sala 12: Labirinto das SequÃªncias</h2>
      <div class="difficulty-indicator extreme">EXTREMO</div>
      <div class="danger-zone">ğŸ’€ ZONA MORTAL</div>
      <div class="question">
        <p id="question12">1, 4, 9, 16, 25, __, 49. Qual Ã© o nÃºmero em falta?</p>
      </div>
      <input type="number" id="answer12" class="answer-input" placeholder="Resposta">
      <button class="btn" onclick="checkAnswer(12)">Submeter Resposta</button>
      <div id="feedback12" class="feedback"></div>
      <div class="hint">ğŸ’¡ <strong>Dica:</strong> SÃ£o quadrados perfeitos: 1Â², 2Â², 3Â²...</div>
    </div>

    <!-- Sala 13: OperaÃ§Ãµes Mistas -->
    <div id="room13" class="room">
      <h2>ğŸ§ª Sala 13: LaboratÃ³rio das OperaÃ§Ãµes Mistas</h2>
      <div class="difficulty-indicator extreme">EXTREMO</div>
      <div class="danger-zone">ğŸ”¥ CALDEIRÃƒO MATEMÃTICO</div>
      <div class="question">
        <p id="question13">(24 + 16) Ã· 8 Ã— 3 - 5 = ?</p>
      </div>
      <input type="number" id="answer13" class="answer-input" placeholder="Resposta">
      <button class="btn" onclick="checkAnswer(13)">Submeter Resposta</button>
      <div id="feedback13" class="feedback"></div>
      <div class="hint">ğŸ’¡ <strong>Dica:</strong> Ordem: parÃªnteses, Ã—Ã· (esquerdaâ†’direita), Â±</div>
    </div>

    <!-- Sala 14: Problemas de Tempo -->
    <div id="room14" class="room">
      <h2>â° Sala 14: MÃ¡quina do Tempo</h2>
      <div class="difficulty-indicator extreme">EXTREMO</div>
      <div class="danger-zone">âš¡ DISTORÃ‡ÃƒO TEMPORAL</div>
      <div class="question">
        <p id="question14">Um filme comeÃ§ou Ã s 19:45 e durou 2h 35min. A que horas terminou?</p>
      </div>
      <input type="text" id="answer14" class="answer-input" placeholder="Ex: 22:20">
      <button class="btn" onclick="checkAnswer(14)">Submeter Resposta</button>
      <div id="feedback14" class="feedback"></div>
      <div class="hint">ğŸ’¡ <strong>Dica:</strong> Some horas e minutos separadamente</div>
    </div>

    <!-- Sala 15: MÃºltiplos e Divisores -->
    <div id="room15" class="room">
      <h2>ğŸ”¢ Sala 15: CÃ¢mara dos MÃºltiplos</h2>
      <div class="difficulty-indicator extreme">EXTREMO</div>
      <div class="danger-zone">ğŸŒªï¸ VÃ“RTICE NUMÃ‰RICO</div>
      <div class="question">
        <p id="question15">Qual Ã© o menor mÃºltiplo comum de 12 e 18?</p>
      </div>
      <input type="number" id="answer15" class="answer-input" placeholder="Resposta">
      <button class="btn" onclick="checkAnswer(15)">Submeter Resposta</button>
      <div id="feedback15" class="feedback"></div>
      <div class="hint">ğŸ’¡ <strong>Dica:</strong> Liste os mÃºltiplos de cada nÃºmero</div>
    </div>

    <!-- Sala 16: Problemas de Velocidade -->
    <div id="room16" class="room">
      <h2>ğŸƒ Sala 16: Pista da Velocidade</h2>
      <div class="difficulty-indicator extreme">EXTREMO</div>
      <div class="danger-zone">ğŸ’¨ CORRIDA CONTRA O TEMPO</div>
      <div class="question">
        <p id="question16">Um carro percorre 240 km em 3 horas. Qual Ã© a sua velocidade mÃ©dia?</p>
      </div>
      <input type="number" id="answer16" class="answer-input" placeholder="km/h">
      <button class="btn" onclick="checkAnswer(16)">Submeter Resposta</button>
      <div id="feedback16" class="feedback"></div>
      <div class="hint">ğŸ’¡ <strong>Dica:</strong> Velocidade = DistÃ¢ncia Ã· Tempo</div>
    </div>

    <!-- Sala 17: Geometria 3D -->
    <div id="room17" class="room">
      <h2>ğŸ“¦ Sala 17: DimensÃ£o CÃºbica</h2>
      <div class="difficulty-indicator extreme">EXTREMO</div>
      <div class="danger-zone">ğŸ² CUBO MÃGICO</div>
      <div class="question">
        <p id="question17">Quantas faces tem um cubo?</p>
      </div>
      <input type="number" id="answer17" class="answer-input" placeholder="NÃºmero de faces">
      <button class="btn" onclick="checkAnswer(17)">Submeter Resposta</button>
      <div id="feedback17" class="feedback"></div>
      <div class="hint">ğŸ’¡ <strong>Dica:</strong> Pense num dado</div>
    </div>

    <!-- Sala 18: EquaÃ§Ãµes Simples -->
    <div id="room18" class="room">
      <h2>âš–ï¸ Sala 18: BalanÃ§a da JustiÃ§a</h2>
      <div class="difficulty-indicator extreme">EXTREMO</div>
      <div class="danger-zone">âš–ï¸ EQUILÃBRIO PERFEITO</div>
      <div class="question">
        <p id="question18">x + 15 = 23. Quanto vale x?</p>
      </div>
      <input type="number" id="answer18" class="answer-input" placeholder="Valor de x">
      <button class="btn" onclick="checkAnswer(18)">Submeter Resposta</button>
      <div id="feedback18" class="feedback"></div>
      <div class="hint">ğŸ’¡ <strong>Dica:</strong> x = 23 - 15</div>
    </div>

    <!-- Sala 19: EstatÃ­stica -->
    <div id="room19" class="room">
      <h2>ğŸ“ˆ Sala 19: Centro de Dados</h2>
      <div class="difficulty-indicator extreme">EXTREMO</div>
      <div class="danger-zone">ğŸ“Š ANÃLISE CRÃTICA</div>
      <div class="question">
        <p id="question19">As idades de 5 amigos sÃ£o: 10, 12, 9, 11, 13. Qual Ã© a mÃ©dia das idades?</p>
      </div>
      <input type="number" id="answer19" class="answer-input" placeholder="MÃ©dia">
      <button class="btn" onclick="checkAnswer(19)">Submeter Resposta</button>
      <div id="feedback19" class="feedback"></div>
      <div class="hint">ğŸ’¡ <strong>Dica:</strong> MÃ©dia = (soma de todos) Ã· (quantidade)</div>
    </div>

    <!-- Sala 20: Probabilidade -->
    <div id="room20" class="room">
      <h2>ğŸ² Sala 20: Casino da Probabilidade</h2>
      <div class="difficulty-indicator extreme">EXTREMO</div>
      <div class="danger-zone">ğŸ€ JOGOS DO DESTINO</div>
      <div class="question">
        <p id="question20">Qual Ã© a probabilidade de sair cara ao lanÃ§ar uma moeda? (em fraÃ§Ã£o)</p>
      </div>
      <input type="text" id="answer20" class="answer-input" placeholder="Ex: 1/2">
      <button class="btn" onclick="checkAnswer(20)">Submeter Resposta</button>
      <div id="feedback20" class="feedback"></div>
      <div class="hint">ğŸ’¡ <strong>Dica:</strong> 1 resultado favorÃ¡vel em 2 possÃ­veis</div>
    </div>

    <!-- Sala 21: Desafio Final -->
    <div id="room21" class="room">
      <h2>ğŸ‘‘ Sala 21: Trono do Conhecimento</h2>
      <div class="difficulty-indicator extreme">LEGENDARY</div>
      <div class="danger-zone">ğŸ‘‘ DESAFIO SUPREMO</div>
      <div class="question">
        <p id="question21">Um aquÃ¡rio tem forma de paralelepÃ­pedo com 50cm de comprimento, 30cm de largura e 40cm de altura. Quantos litros de Ã¡gua cabem? (1 litro = 1000 cmÂ³)</p>
      </div>
      <input type="number" id="answer21" class="answer-input" placeholder="Litros">
      <button class="btn" onclick="checkAnswer(21)">Submeter Resposta</button>
      <div id="feedback21" class="feedback"></div>
      <div class="hint">ğŸ’¡ <strong>Dica:</strong> Volume = comprimento Ã— largura Ã— altura</div>
    </div>

    <!-- Sala 22: Enigma dos Mestres -->
    <div id="room22" class="room">
      <h2>ğŸ§™ Sala 22: Enigma dos Mestres MatemÃ¡ticos</h2>
      <div class="difficulty-indicator extreme">LEGENDARY</div>
      <div class="danger-zone">ğŸ”® MAGIA PURA</div>
      <div class="question">
        <p id="question22">Pensando em um nÃºmero. Se somar 12, multiplicar por 3 e subtrair 21, obtenho 24. Que nÃºmero pensei?</p>
      </div>
      <input type="number" id="answer22" class="answer-input" placeholder="O nÃºmero pensado">
      <button class="btn" onclick="checkAnswer(22)">Submeter Resposta</button>
      <div id="feedback22" class="feedback"></div>
      <div class="hint">ğŸ’¡ <strong>Dica:</strong> Trabalhe para trÃ¡s: (24 + 21) Ã· 3 - 12</div>
    </div>

    <!-- Sala Final: CelebraÃ§Ã£o -->
    <div id="room23" class="room celebration">
      <h2>ğŸ‰ VITÃ“RIA Ã‰PICA!</h2>
      <p style="font-size: 24px;">ğŸ‘‘ğŸ†ğŸŠ</p>
      <p><strong id="team-display"></strong></p>
      <p>Escaparam do Museu dos NÃºmeros Perdidos!</p>
      <div style="margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 10px;">
        <p><strong>PontuaÃ§Ã£o Final:</strong> <span id="final-score"></span> pontos</p>
        <p><strong>Tempo Total:</strong> <span id="final-time"></span></p>
        <p><strong>ClassificaÃ§Ã£o:</strong> <span id="rating"></span></p>
        <p><strong>Recuos Sofridos:</strong> <span id="total-backtracks"></span></p>
      </div>
      <button class="btn" onclick="restartGame()">ğŸ”„ Nova Aventura</button>
    </div>
  </div>

  <script>
    let currentRoom = 0;
    let score = 0;
    let startTime = Date.now();
    let teamName = "";
    let roomStartTime = Date.now();
    let attempts = {};
    let timerInterval;
    let totalBacktracks = 0;
    
    // Inicializar tentativas para cada sala
    for(let i = 1; i <= 22; i++) {
      attempts[i] = 0;
    }
    
    // Banco de perguntas expandido
    let questions = {
      1: [
        { question: "47 + 38 = ?", answer: 85 },
        { question: "56 + 29 = ?", answer: 85 },
        { question: "73 + 12 = ?", answer: 85 }
      ],
      2: [
        { question: "205 - 87 = ?", answer: 118 },
        { question: "304 - 186 = ?", answer: 118 },
        { question: "250 - 132 = ?", answer: 118 }
      ],
      3: [
        { question: "13 Ã— 7 = ?", answer: 91 },
        { question: "14 Ã— 6 = ?", answer: 84 },
        { question: "12 Ã— 8 = ?", answer: 96 }
      ],
      4: [
        { question: "127 Ã· 8 = ? (qual Ã© o quociente?)", answer: 15 },
        { question: "143 Ã· 9 = ? (qual Ã© o quociente?)", answer: 15 },
        { question: "135 Ã· 9 = ? (qual Ã© o quociente?)", answer: 15 }
      ],
      5: [
        { question: "Qual destas fraÃ§Ãµes Ã© equivalente a 2/3?\nA) 4/6   B) 3/4   C) 6/8   D) 5/9", answer: "A" },
        { question: "Qual destas fraÃ§Ãµes Ã© equivalente a 3/4?\nA) 6/9   B) 6/8   C) 4/5   D) 7/8", answer: "B" },
        { question: "Qual destas fraÃ§Ãµes Ã© equivalente a 1/2?\nA) 2/3   B) 3/6   C) 4/7   D) 5/9", answer: "B" }
      ],
      6: [
        { question: "Um retÃ¢ngulo tem 15 cm de comprimento e 9 cm de largura. Qual Ã© o seu perÃ­metro?", answer: 48 },
        { question: "Um retÃ¢ngulo tem 18 cm de comprimento e 7 cm de largura. Qual Ã© o seu perÃ­metro?", answer: 50 },
        { question: "Um retÃ¢ngulo tem 14 cm de comprimento e 11 cm de largura. Qual Ã© o seu perÃ­metro?", answer: 50 }
      ],
      7: [
        { question: "O Pedro comprou 4 livros por 8,75â‚¬ cada e pagou com uma nota de 50â‚¬. Quanto recebeu de troco?", answer: 15.00 },
        { question: "A Ana comprou 3 brinquedos por 12,50â‚¬ cada e pagou com uma nota de 50â‚¬. Quanto recebeu de troco?", answer: 12.50 },
        { question: "O JoÃ£o comprou 5 canetas por 2,80â‚¬ cada e pagou com uma nota de 20â‚¬. Quanto recebeu de troco?", answer: 6.00 }
      ],
      8: [
        { question: "Qual Ã© a Ã¡rea de um quadrado com 12 cm de lado?", answer: 144 },
        { question: "Qual Ã© a Ã¡rea de um quadrado com 15 cm de lado?", answer: 225 },
        { question: "Qual Ã© a Ã¡rea de um quadrado com 11 cm de lado?", answer: 121 }
      ],
      9: [
        { question: "3,7 + 2,85 + 1,049 = ?", answer: 7.599 },
        { question: "4,2 + 1,75 + 2,033 = ?", answer: 7.983 },
        { question: "5,1 + 0,84 + 1,672 = ?", answer: 7.612 }
      ],
      10: [
        { question: "3/4 + 2/8 = ? (simplifique a resposta)", answer: "1/1" },
        { question: "2/3 + 1/6 = ? (simplifique a resposta)", answer: "5/6" },
        { question: "1/2 + 3/8 = ? (simplifique a resposta)", answer: "7/8" }
      ],
      11: [
        { question: "Numa turma de 25 alunos, 60% sÃ£o raparigas. Quantas raparigas hÃ¡?", answer: 15 },
        { question: "Numa escola de 200 alunos, 35% sÃ£o do 5Âº ano. Quantos alunos do 5Âº ano hÃ¡?", answer: 70 },
        { question: "Num parque de 80 Ã¡rvores, 25% sÃ£o carvalhos. Quantos carvalhos hÃ¡?", answer: 20 }
      ],
      12: [
        { question: "1, 4, 9, 16, 25, __, 49. Qual Ã© o nÃºmero em falta?", answer: 36 },
        { question: "2, 8, 18, 32, 50, __. Qual Ã© o prÃ³ximo nÃºmero?", answer: 72 },
        { question: "1, 8, 27, 64, __. Qual Ã© o prÃ³ximo nÃºmero?", answer: 125 }
      ],
      13: [
        { question: "(24 + 16) Ã· 8 Ã— 3 - 5 = ?", answer: 10 },
        { question: "(18 + 12) Ã· 6 Ã— 4 - 8 = ?", answer: 12 },
        { question: "(35 + 25) Ã· 12 Ã— 6 - 15 = ?", answer: 15 }
      ],
      14: [
        { question: "Um filme comeÃ§ou Ã s 19:45 e durou 2h 35min. A que horas terminou?", answer: "22:20" },
        { question: "Um espetÃ¡culo comeÃ§ou Ã s 20:15 e durou 1h 50min. A que horas terminou?", answer: "22:05" },
        { question: "Uma viagem comeÃ§ou Ã s 14:30 e durou 3h 25min. A que horas terminou?", answer: "17:55" }
      ],
      15: [
        { question: "Qual Ã© o menor mÃºltiplo comum de 12 e 18?", answer: 36 },
        { question: "Qual Ã© o menor mÃºltiplo comum de 6 e 8?", answer: 24 },
        { question: "Qual Ã© o menor mÃºltiplo comum de 15 e 20?", answer: 60 }
      ],
      16: [
        { question: "Um carro percorre 240 km em 3 horas. Qual Ã© a sua velocidade mÃ©dia?", answer: 80 },
        { question: "Um comboio percorre 450 km em 5 horas. Qual Ã© a sua velocidade mÃ©dia?", answer: 90 },
        { question: "Um ciclista percorre 72 km em 4 horas. Qual Ã© a sua velocidade mÃ©dia?", answer: 18 }
      ],
      17: [
        { question: "Quantas faces tem um cubo?", answer: 6 },
        { question: "Quantas arestas tem um cubo?", answer: 12 },
        { question: "Quantos vÃ©rtices tem um cubo?", answer: 8 }
      ],
      18: [
        { question: "x + 15 = 23. Quanto vale x?", answer: 8 },
        { question: "y - 12 = 18. Quanto vale y?", answer: 30 },
        { question: "z + 7 = 25. Quanto vale z?", answer: 18 }
      ],
      19: [
        { question: "As idades de 5 amigos sÃ£o: 10, 12, 9, 11, 13. Qual Ã© a mÃ©dia das idades?", answer: 11 },
        { question: "As notas de um aluno sÃ£o: 8, 7, 9, 6, 10. Qual Ã© a mÃ©dia?", answer: 8 },
        { question: "Os preÃ§os de 4 artigos sÃ£o: 5â‚¬, 8â‚¬, 12â‚¬, 7â‚¬. Qual Ã© o preÃ§o mÃ©dio?", answer: 8 }
      ],
      20: [
        { question: "Qual Ã© a probabilidade de sair cara ao lanÃ§ar uma moeda? (em fraÃ§Ã£o)", answer: "1/2" },
        { question: "Qual Ã© a probabilidade de sair 6 ao lanÃ§ar um dado? (em fraÃ§Ã£o)", answer: "1/6" },
        { question: "Qual Ã© a probabilidade de tirar uma carta vermelha de um baralho? (em fraÃ§Ã£o)", answer: "1/2" }
      ],
      21: [
        { question: "Um aquÃ¡rio tem forma de paralelepÃ­pedo com 50cm de comprimento, 30cm de largura e 40cm de altura. Quantos litros de Ã¡gua cabem? (1 litro = 1000 cmÂ³)", answer: 60 },
        { question: "Uma caixa tem 40cm Ã— 25cm Ã— 32cm. Qual Ã© o seu volume em litros?", answer: 32 },
        { question: "Um recipiente tem 60cm Ã— 20cm Ã— 25cm. Quantos litros cabem?", answer: 30 }
      ],
      22: [
        { question: "Pensando em um nÃºmero. Se somar 12, multiplicar por 3 e subtrair 21, obtenho 24. Que nÃºmero pensei?", answer: 3 },
        { question: "Pensando em um nÃºmero. Se multiplicar por 4, somar 8 e dividir por 2, obtenho 16. Que nÃºmero pensei?", answer: 6 },
        { question: "Pensando em um nÃºmero. Se somar 5, multiplicar por 2 e subtrair 6, obtenho 14. Que nÃºmero pensei?", answer: 5 }
      ]
    };
    
    let currentQuestions = {};
    
    function updateTimer() {
      const elapsed = Math.floor((Date.now() - startTime) / 1000);
      const minutes = Math.floor(elapsed / 60);
      const seconds = elapsed % 60;
      document.getElementById('timer').textContent = 
        String(minutes).padStart(2, '0') + ':' + String(seconds).padStart(2, '0');
    }
    
    function updateProgress() {
      const progress = (currentRoom / 23) * 100;
      document.getElementById('progress').style.width = progress + '%';
    }
    
    function startGame() {
      teamName = document.getElementById('team-name').value.trim();
      if (!teamName) {
        alert('Por favor, escolham um nome para a vossa equipa!');
        return;
      }
      
      currentRoom = 1;
      startTime = Date.now();
      roomStartTime = Date.now();
      totalBacktracks = 0;
      
      // Escolher perguntas aleatÃ³rias para cada sala
      for (let i = 1; i <= 22; i++) {
        let randomIndex = Math.floor(Math.random() * questions[i].length);
        currentQuestions[i] = questions[i][randomIndex];
        
        // Atualizar a interface com a pergunta selecionada
        document.getElementById('question' + i).textContent = questions[i][randomIndex].question;
      }
      
      document.getElementById('room0').classList.remove('active');
      document.getElementById('room1').classList.add('active');
      document.getElementById('current-room').textContent = currentRoom;
      
      updateProgress();
      timerInterval = setInterval(updateTimer, 1000);
    }
    
    function calculatePoints(basePoints, timeBonus = true) {
      let points = basePoints;
      
      // Penalizar tentativas mÃºltiplas mais severamente
      const attemptPenalty = (attempts[currentRoom] - 1) * 50;
      points = Math.max(points - attemptPenalty, 50);
      
      if (timeBonus) {
        const roomTime = Math.floor((Date.now() - roomStartTime) / 1000);
        if (roomTime <= 20) points += 100; // Bonus maior por rapidez
        else if (roomTime <= 45) points += 60;
        else if (roomTime <= 90) points += 30;
      }
      
      return Math.max(points, 25); // MÃ­nimo 25 pontos
    }
    
    function checkAnswer(room) {
      attempts[room] = (attempts[room] || 0) + 1;
      
      let input = document.getElementById('answer' + room).value.trim();
      let feedback = document.getElementById('feedback' + room);
      let isCorrect = false;
      let correctAnswer = currentQuestions[room].answer;
      
      // VerificaÃ§Ã£o especÃ­fica por tipo de resposta
      if (typeof correctAnswer === 'string') {
        if (correctAnswer.includes('/')) {
          // Para fraÃ§Ãµes
          isCorrect = (input === correctAnswer || input.replace(':', '/') === correctAnswer);
        } else if (correctAnswer.includes(':')) {
          // Para tempo
          isCorrect = (input === correctAnswer || 
                      input.replace('h', ':').replace('m', '').replace(' ', '') === correctAnswer);
        } else {
          // Para letras (A, B, C, D)
          isCorrect = (input.toUpperCase() === correctAnswer.toUpperCase());
        }
      } else {
        // Para nÃºmeros
        isCorrect = (Math.abs(parseFloat(input) - correctAnswer) < 0.01);
      }
      
      if (isCorrect) {
        // Resposta correta
        const basePoints = [0, 100, 120, 150, 170, 200, 220, 250, 280, 300, 350, 400, 450, 500, 550, 600, 650, 700, 750, 800, 850, 900, 1000][room] || 1000;
        const earnedPoints = calculatePoints(basePoints);
        score += earnedPoints;
        
        feedback.innerHTML = `<div class="success">
          âœ… Correto! +${earnedPoints} pontos<br>
          ğŸš€ A avanÃ§ar para a prÃ³xima sala...
        </div>`;
        
        document.getElementById('score').textContent = score;
        
        setTimeout(function() {
          document.getElementById('room' + room).classList.remove('active');
          currentRoom++;
          
          if (currentRoom <= 22) {
            document.getElementById('room' + currentRoom).classList.add('active');
            document.getElementById('current-room').textContent = currentRoom;
            roomStartTime = Date.now();
          } else {
            finishGame();
          }
          
          updateProgress();
        }, 2000);
        
      } else {
        // Resposta incorreta
        let attemptsLeft = 3 - attempts[room];
        
        // PenalizaÃ§Ã£o por erro
        let pointPenalty = Math.min(100, score * 0.1); // 10% da pontuaÃ§Ã£o atual, mÃ¡ximo 100
        score = Math.max(0, score - pointPenalty);
        document.getElementById('score').textContent = score;
        
        if (attemptsLeft > 0) {
          feedback.innerHTML = `<div class="error">
            âŒ Resposta incorreta! -${Math.floor(pointPenalty)} pontos<br>
            Tens mais ${attemptsLeft} tentativa(s).<br>
            ğŸ’¡ Tenta novamente!
          </div>`;
        } else {
          // Sem mais tentativas
          if (room >= 10) {
            // ZONA PERIGOSA - Recuar aleatoriamente
            let backtrackRooms = Math.floor(Math.random() * 4) + 2; // Recua 2-5 salas
            let newRoom = Math.max(1, currentRoom - backtrackRooms);
            totalBacktracks++;
            
            feedback.innerHTML = `<div class="error">
              âŒ Resposta incorreta! A resposta era: ${correctAnswer}<br>
              ğŸ”¥ RECUAS ${backtrackRooms} SALAS! (Sala ${newRoom})
            </div>`;
            
            setTimeout(function() {
              document.getElementById('room' + room).classList.remove('active');
              currentRoom = newRoom;
              document.getElementById('room' + currentRoom).classList.add('active');
              document.getElementById('current-room').textContent = currentRoom;
              roomStartTime = Date.now();
              updateProgress();
              
              showPenaltyMessage(`ğŸ’€ RECUASTE ${backtrackRooms} SALAS! Agora estÃ¡s na sala ${newRoom}!`, "#f8d7da");
            }, 3000);
          } else {
            // Zona normal - apenas avanÃ§a
            feedback.innerHTML = `<div class="error">
              âŒ Resposta incorreta! A resposta era: ${correctAnswer}<br>
              ğŸš€ A avanÃ§ar para a prÃ³xima sala...
            </div>`;
            
            setTimeout(function() {
              document.getElementById('room' + room).classList.remove('active');
              currentRoom++;
              
              if (currentRoom <= 22) {
                document.getElementById('room' + currentRoom).classList.add('active');
                document.getElementById('current-room').textContent = currentRoom;
                roomStartTime = Date.now();
              } else {
                finishGame();
              }
              
              updateProgress();
            }, 3000);
          }
        }
      }
    }
    
    function finishGame() {
      clearInterval(timerInterval);
      
      // Mostrar sala de celebraÃ§Ã£o
      document.getElementById('room23').classList.add('active');
      document.getElementById('team-display').textContent = teamName;
      document.getElementById('final-score').textContent = score;
      document.getElementById('total-backtracks').textContent = totalBacktracks;
      
      const elapsed = Math.floor((Date.now() - startTime) / 1000);
      const minutes = Math.floor(elapsed / 60);
      const seconds = elapsed % 60;
      document.getElementById('final-time').textContent = 
        String(minutes).padStart(2, '0') + ':' + String(seconds).padStart(2, '0');
      
      // Calcular classificaÃ§Ã£o mais rigorosa
      let rating = "";
      if (score >= 8000 && totalBacktracks === 0) rating = "ğŸ‘‘ MESTRES SUPREMOS DA MATEMÃTICA!";
      else if (score >= 6000 && totalBacktracks <= 1) rating = "ğŸ† GÃ‰NIOS MATEMÃTICOS!";
      else if (score >= 4500 && totalBacktracks <= 3) rating = "â­ EXCELENTE PERFORMANCE!";
      else if (score >= 3000) rating = "ğŸ‘ MUITO BOM!";
      else if (score >= 2000) rating = "ğŸ˜Š BOM TRABALHO!";
      else if (score >= 1000) rating = "ğŸ’ª CONTINUEM A PRATICAR!";
      else rating = "ğŸ“š PRECISAM DE MAIS ESTUDO!";
      
      document.getElementById('rating').textContent = rating;
    }
    
    function yellowCard() {
      score = Math.max(0, score - 150);
      document.getElementById('score').textContent = score;
      
      showPenaltyMessage("ğŸŸ¨ CartÃ£o Amarelo! -150 pontos", "#fff3cd");
    }
    
    function redCard() {
      if (confirm("CartÃ£o Vermelho! Isto irÃ¡ reiniciar o jogo. Tens a certeza?")) {
        restartGame();
      }
    }
    
    function showPenaltyMessage(message, backgroundColor) {
      const alert = document.getElementById('penalty-alert');
      alert.innerHTML = `<div class="penalty-message" style="background: ${backgroundColor};">${message}</div>`;
      alert.style.display = 'block';
      
      setTimeout(() => {
        alert.style.display = 'none';
      }, 4000);
    }
    
    function restartGame() {
      // Reset todas as variÃ¡veis
      currentRoom = 0;
      score = 0;
      startTime = Date.now();
      roomStartTime = Date.now();
      teamName = "";
      totalBacktracks = 0;
      
      // Reset tentativas
      for(let i = 1; i <= 22; i++) {
        attempts[i] = 0;
      }
      
      // Reset interface
      document.getElementById('score').textContent = '0';
      document.getElementById('current-room').textContent = '0';
      document.getElementById('timer').textContent = '00:00';
      document.getElementById('team-name').value = '';
      document.getElementById('progress').style.width = '0%';
      
      // Limpar todos os feedbacks e inputs
      for(let i = 1; i <= 22; i++) {
        document.getElementById('answer' + i).value = '';
        document.getElementById('feedback' + i).innerHTML = '';
      }
      
      // Esconder todas as salas e mostrar apenas a sala 0
      for(let i = 1; i <= 23; i++) {
        document.getElementById('room' + i).classList.remove('active');
      }
      document.getElementById('room0').classList.add('active');
      
      // Parar timer se estiver a correr
      if (timerInterval) {
        clearInterval(timerInterval);
      }
    }
    
    // Adicionar eventos de teclado
    document.addEventListener('DOMContentLoaded', function() {
      for(let i = 1; i <= 22; i++) {
        document.getElementById('answer' + i).addEventListener('keypress', function(e) {
          if (e.key === 'Enter') {
            checkAnswer(i);
          }
        });
      }
      
      document.getElementById('team-name').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          startGame();
        }
      });
    });
  </script>
</body>
</html>